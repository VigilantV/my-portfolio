import { useRef, useEffect, useState } from "react";
import { Button } from "@mui/material";
import TextFieldTemplate from "./TextFieldTemplate";
import textShiveringAnimation from "../../../animations/textShiveringAnimation";
import downloadFile from "../../common/downloadFile";
import sendEmail from "./sendEmail";
import classes from "../../../styles/desktop/contact.module.scss";
import COLORS from "../../../styles/theme";
import telegram from "../../../images/icons/telegram.png";
import github from "../../../images/icons/github.png";
import linkedin from "../../../images/icons/linkedin.png";

const Contact = ({ currentSectionIndex }) => {
  const [titleAnimated, setTitleAnimated] = useState(false);

  const formRef = useRef();
  const contactAnimationRef = useRef(null);

  useEffect(() => {
    let ctx = textShiveringAnimation(contactAnimationRef);
    return () => {
      ctx.revert();
    };
  }, []);

  useEffect(() => {
    if (currentSectionIndex === 2 && !titleAnimated) {
      setTimeout(() => {
        setTitleAnimated(true);
      }, 500);
    }
  }, [currentSectionIndex, titleAnimated]);

  return (
    <div id="contact_section" className={classes.contact_section}>
      <div className={classes.title}>
        <svg
          width="21vw"
          viewBox="-1 10 245.5 36"
          preserveAspectRatio="xMidYMid meet"
        >
          <path
            className={`${classes.title_path} ${
              titleAnimated ? classes.animate : ""
            }`}
            d="M14.60 45.30Q10.60 45.30 7.25 43.50Q3.90 41.70 1.95 38.27Q0 34.85 0 30.25Q0 25.40 2.28 20.97Q4.55 16.55 8.18 13.88Q11.80 11.20 15.60 11.20Q17.20 11.20 18.78 11.70Q20.35 12.20 21.60 12.95Q22.20 12.35 23.10 12.35Q24.10 12.35 24.75 13.02Q25.40 13.70 25.40 14.65L25.40 17.85Q25.40 18.85 24.68 19.60Q23.95 20.35 22.90 20.35Q21.90 20.35 21.23 19.75Q20.55 19.15 20.55 18.35L20.55 18Q18.70 16.05 15.25 16.05Q12.75 16.05 10.35 18.07Q7.95 20.10 6.47 23.40Q5 26.70 5 30.25Q5 33.40 6.30 35.73Q7.60 38.05 9.78 39.27Q11.95 40.50 14.60 40.50Q19.45 40.50 22.60 36.35Q23.05 35.80 23.50 35.58Q23.95 35.35 24.55 35.35Q25.60 35.35 26.33 36.02Q27.05 36.70 27.05 37.85Q27.05 38.70 26.60 39.35Q24.55 42.25 21.43 43.77Q18.30 45.30 14.60 45.30ZM40.25 45.30Q37.40 45.30 35.02 43.75Q32.65 42.20 31.30 39.52Q29.95 36.85 29.95 33.70Q29.95 30.15 31.55 27.07Q33.15 24 35.85 22.17Q38.55 20.35 41.65 20.35Q44.50 20.35 46.88 21.95Q49.25 23.55 50.63 26.20Q52 28.85 52 31.90Q52 35.50 50.40 38.58Q48.80 41.65 46.08 43.48Q43.35 45.30 40.25 45.30M40.25 40.80Q42 40.80 43.60 39.60Q45.20 38.40 46.15 36.40Q47.10 34.40 47.10 32.15Q47.10 30.25 46.35 28.57Q45.60 26.90 44.30 25.88Q43 24.85 41.45 24.85Q39.70 24.85 38.17 26.07Q36.65 27.30 35.75 29.32Q34.85 31.35 34.85 33.65Q34.85 35.90 35.63 37.50Q36.40 39.10 37.63 39.95Q38.85 40.80 40.25 40.80ZM59.80 45.30Q58.85 45.30 58.13 44.60Q57.40 43.90 57.40 43L57.40 22.70Q57.40 21.70 58.15 21Q58.90 20.30 59.90 20.30Q60.85 20.30 61.53 21Q62.20 21.70 62.20 22.70L62.20 26.50Q63.60 23.50 65.75 21.92Q67.90 20.35 70.45 20.35Q73.25 20.35 74.90 21.65Q76.55 22.95 77.30 25.93Q78.05 28.90 78.05 34.15L78 42.90Q78 43.85 77.35 44.58Q76.70 45.30 75.70 45.30Q74.75 45.30 74.03 44.58Q73.30 43.85 73.30 42.95L73.30 34.65Q73.30 30.75 72.95 28.65Q72.60 26.55 71.90 25.77Q71.20 25 70 25Q68.50 25 67 26.27Q65.50 27.55 64.20 29.90Q63.05 31.95 62.60 33.90Q62.15 35.85 62.15 38.60L62.15 42.80Q62.15 43.90 61.53 44.60Q60.90 45.30 59.80 45.30ZM88.90 45.35Q87.95 45.35 87.23 44.65Q86.50 43.95 86.50 43L86.50 25.15L82.55 25.15Q81.55 25.15 80.85 24.42Q80.15 23.70 80.15 22.75Q80.15 21.65 80.90 20.97Q81.65 20.30 82.65 20.30L86.50 20.30L86.50 14.95Q86.50 14 87.20 13.25Q87.90 12.50 88.90 12.50Q89.95 12.50 90.63 13.22Q91.30 13.95 91.30 14.95L91.30 20.30L95.55 20.30Q96.55 20.30 97.25 21Q97.95 21.70 97.95 22.75Q97.95 23.70 97.25 24.42Q96.55 25.15 95.55 25.15L91.30 25.15L91.30 43Q91.30 43.95 90.60 44.65Q89.90 45.35 88.90 45.35ZM116.95 45.80Q115.95 45.80 115.33 45.25Q114.70 44.70 114.70 43.80L114.70 43.10Q112.65 45.30 109.00 45.30Q106.25 45.30 104.05 43.95Q101.85 42.60 100.60 40.13Q99.35 37.65 99.35 34.50Q99.35 31 100.85 27.72Q102.35 24.45 105.08 22.40Q107.80 20.35 111.35 20.35Q113.65 20.35 115.50 20.97Q117.35 21.60 119.35 22.50L119.35 43.30Q119.35 44.30 118.65 45.05Q117.95 45.80 116.95 45.80M109.35 40.65Q110.80 40.65 112.18 40.05Q113.55 39.45 114.45 38.60L114.60 25.55Q113.15 24.95 111.45 24.95Q109.30 24.95 107.65 26.27Q106.00 27.60 105.10 29.77Q104.20 31.95 104.20 34.40Q104.20 37.45 105.55 39.05Q106.90 40.65 109.35 40.65ZM135.65 45.30Q132.65 45.30 130.15 43.85Q127.65 42.40 126.20 39.88Q124.75 37.35 124.75 34.35Q124.75 30.95 126.35 27.70Q127.95 24.45 130.55 22.40Q133.15 20.35 136.05 20.35Q138.70 20.35 140.33 21.17Q141.95 22 143.50 23.80Q144.25 24.60 144.25 25.55Q144.25 26.50 143.55 27.18Q142.85 27.85 141.85 27.85Q141.20 27.85 140.83 27.65Q140.45 27.45 139.95 26.85Q139.10 25.90 138.28 25.40Q137.45 24.90 136.10 24.90Q134.55 24.90 132.98 26.25Q131.40 27.60 130.43 29.77Q129.45 31.95 129.45 34.25Q129.45 36.25 130.33 37.73Q131.20 39.20 132.60 39.98Q134.00 40.75 135.55 40.75Q137.55 40.75 138.83 40Q140.10 39.25 141.10 37.95Q142.05 36.70 143.25 36.70Q144.20 36.70 144.90 37.38Q145.60 38.05 145.60 38.90Q145.60 39.90 145.05 40.60Q143.60 42.55 141.10 43.92Q138.60 45.30 135.65 45.30ZM154.20 45.35Q153.25 45.35 152.53 44.65Q151.80 43.95 151.80 43L151.80 25.15L147.85 25.15Q146.85 25.15 146.15 24.42Q145.45 23.70 145.45 22.75Q145.45 21.65 146.20 20.97Q146.95 20.30 147.95 20.30L151.80 20.30L151.80 14.95Q151.80 14 152.50 13.25Q153.20 12.50 154.20 12.50Q155.25 12.50 155.93 13.22Q156.60 13.95 156.60 14.95L156.60 20.30L160.85 20.30Q161.85 20.30 162.55 21Q163.25 21.70 163.25 22.75Q163.25 23.70 162.55 24.42Q161.85 25.15 160.85 25.15L156.60 25.15L156.60 43Q156.60 43.95 155.90 44.65Q155.20 45.35 154.20 45.35ZM184.30 45.30Q183.20 45.30 182.58 44.65Q181.95 44 181.95 43.20Q181.95 42.40 182.15 41.55L188.35 13.20Q188.55 12.30 189.20 11.77Q189.85 11.25 190.80 11.25Q192.55 11.25 193.10 12.95L200.15 35.10L208.15 12.85Q208.75 11.25 210.65 11.25Q211.50 11.25 212.08 11.77Q212.65 12.30 212.85 13.20L219.20 41.50Q219.45 42.65 219.45 43Q219.45 43.95 218.75 44.63Q218.05 45.30 217.00 45.30Q216.00 45.30 215.40 44.77Q214.80 44.25 214.60 43.40L210.00 22.50L202.30 43.70Q202.05 44.45 201.40 44.88Q200.75 45.30 199.95 45.30Q198.20 45.30 197.65 43.60L191.15 23.25L186.75 43.35Q186.55 44.25 185.90 44.77Q185.25 45.30 184.30 45.30ZM235.15 45.30Q231.60 45.30 228.78 43.77Q225.95 42.25 224.35 39.42Q222.75 36.60 222.75 32.75Q222.75 29.60 224.18 26.72Q225.60 23.85 228.18 22.10Q230.75 20.35 234.05 20.35Q237.10 20.35 239.28 21.57Q241.45 22.80 242.55 24.50Q243.65 26.20 243.65 27.55Q243.65 28.20 243.25 28.80Q242.85 29.40 242.10 29.85L228.70 37.55Q229.40 39.10 231.18 39.95Q232.95 40.80 235.15 40.80Q238.05 40.80 240.10 38.65Q240.90 37.85 241.75 37.85Q242.75 37.85 243.43 38.50Q244.10 39.15 244.10 40.10Q244.10 40.90 243.50 41.60Q242.10 43.15 239.78 44.23Q237.45 45.30 235.15 45.30M238.70 26.95Q238.10 25.90 237.00 25.38Q235.90 24.85 234.40 24.85Q231.55 24.85 229.63 26.80Q227.70 28.75 227.40 31.60Q227.30 32.35 227.30 33.40L238.70 26.95Z"
          />
        </svg>
      </div>
      <div className={classes.resume_btn}>
        <p
          ref={contactAnimationRef}
          style={{ cursor: "pointer" }}
          onClick={downloadFile}
        >
          my resume
        </p>
      </div>
      <div className={classes.contact_box}>
        <form
          ref={formRef}
          className={classes.input_section}
          onSubmit={(e) => sendEmail(e, formRef)}
        >
          <p className={classes.question}>
            Have a question or wanna get in touch ?
          </p>
          <TextFieldTemplate label="Name" name="from_name" type="text" />
          <TextFieldTemplate label="Email" name="from_email" type="email" />
          <textarea
            name="message"
            placeholder="Message"
            required
            className={classes.text_area}
          />
          <Button
            type="submit"
            variant="contained"
            sx={{
              alignSelf: "end",
              width: "7vw",
              height: "2.6vw",
              fontSize: "1.25vw",
              fontFamily: "calibri",
              whiteSpace: "nowrap",
              marginRight: "2vw",
              color: COLORS.whitish,
              backgroundColor: COLORS.rouge,
              borderRadius: "0.5vw",
              "&:hover": {
                background: COLORS.lightRouge,
              },
              transition: "background-color 0.3s",
            }}
          >
            Submit
          </Button>
        </form>
        <div className={classes.icons_section}>
          <a
            href="https://t.me/Classicplayer"
            rel="noopener noreferrer"
            target="_blank"
          >
            <img className={classes.telegram} src={telegram} alt="telegram" />
          </a>
          <a
            href="https://github.com/VigilantV"
            rel="noopener noreferrer"
            target="_blank"
          >
            <img className={classes.github} src={github} alt="github" />
          </a>
          <a
            href="https://www.linkedin.com/in/mehrabgheibi/"
            rel="noopener noreferrer"
            target="_blank"
          >
            <img className={classes.linkedin} src={linkedin} alt="linkedin" />
          </a>
        </div>
      </div>
    </div>
  );
};

export default Contact;
